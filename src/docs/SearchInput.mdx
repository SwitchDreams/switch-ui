import { Meta, Controls } from '@storybook/blocks';

<Meta title="Copy and Paste/Search Input" />

## Search Input

É necessário instalar o [react-select](https://react-select.com/home#getting-started) para usar esse componente.


## Usage

Copie esse código para o seu projeto:

```jsx
import { CheckIcon, XMarkIcon } from "@heroicons/react/24/outline";
import { cva } from "class-variance-authority";
import React, { useEffect, useState } from "react";
import Select, { components } from "react-select";
import { twMerge } from "tailwind-merge";

import zenColors from "../../constants/colors";

const customStyles = {
  control: (provided) => ({
    ...provided,
  }),
  singleValue: (provided) => ({
    ...provided,
    color: `${zenColors.primary[950]}`,
  }),
  placeholder: (provided) => ({
    ...provided,
    color: `${zenColors.primary[400]}`,
  }),
  indicatorSeparator: (provided) => ({
    ...provided,
    backgroundColor: `${zenColors.primary[100]}`,
  }),
  dropdownIndicator: (provided) => ({
    ...provided,
    color: `${zenColors.primary[400]}`,
    strokeWidth: "0.5px",
    "&:hover": {
      color: `${zenColors.primary[400]}`,
    },
  }),
  multiValue: (provided) => ({
    ...provided,
    backgroundColor: `${zenColors.primary[100]}`,
    borderRadius: "4px",
    margin: "2px",
    color: `${zenColors.primary[950]}`,
  }),
  loadingIndicator: (base) => ({
    ...base,
    color: `${zenColors.secondary[100]}`,
  }),
};

export const SearchInputButtonVariants = cva(
  "rounded-plug-md my-2 flex w-full cursor-default border text-left text-gray-600 hover:bg-gray-50 focus:bg-warning-400 ",
  {
    variants: {
      disabled: {
        true: "opacity-40",
        false: "opacity-100",
      },
      size: {
        lg: "x-1 text-md h-14",
        md: "x-0.5 text-md h-11",
        sm: "x text-md h-10",
      },
      open: {
        true: "border-primary-800",
        false: "border-primary-200",
      },
      error: {
        true: "border-error-600",
      },
    },
  },
);

export const dropdownIconVariant = cva("cursor-pointer text-gray-700", {
  variants: {
    size: {
      lg: "h-6 w-6",
      md: "h-5 w-5",
      sm: "h-5 w-5",
    },
  },
});

const debounce = (fn, delay) => {
  let timeoutId;
  return function (...args) {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => fn(...args), delay);
  };
};

const selectAllOption = { value: "selectAll", label: "Selecionar Todos" };

const SearchInput = ({
  name,
  size = "md",
  error = false,
  placeholder = "",
  value,
  multiple = false,
  fetchRemoteData,
  remoteDataConfig = {
    debounceTime: 300,
  },
  options,
  className,
  disabled = false,
  label,
  selectAll = false,
  onChange,
}) => {
  const defaultSelected = () => {
    if (multiple && value) {
      return options.filter((option) => value.includes(option.value));
    } else {
      return options.find((option) => option.value === value);
    }
  };

  const [selected, setSelected] = useState(defaultSelected());
  const [optionsInput, setOptionsInput] = useState(options);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    setOptionsInput(options);

    setSelected(defaultSelected());
  }, [options]);

  useEffect(() => {
    if (!fetchRemoteData) {
      return;
    }

    const fetchData = async () => {
      try {
        setLoading(true);
        const data = await fetchRemoteData();
        setOptionsInput(data);
      } finally {
        setLoading(false);
      }
    };

    const debouncedFetchData = debounce(fetchData, remoteDataConfig.debounceTime);

    debouncedFetchData();
  }, [fetchRemoteData]);

  const handleSelectChange = (selectedOption) => {
    if (multiple) {
      if (selectedOption.some((option) => option.value === "selectAll")) {
        setSelected(optionsInput);
        onChange(optionsInput.map((option) => option.value));
      } else {
        setSelected(selectedOption);
        onChange(selectedOption.map((option) => option.value));
      }
    } else {
      onChange(selectedOption.value);
      setSelected(selectedOption);
    }
  };

  const ControlOption = ({ innerRef, innerProps, isDisabled, menuIsOpen, ...props }) => {
    return (
      <div ref={innerRef} {...innerProps}>
        <components.SelectContainer
          className={SearchInputButtonVariants({
            disabled: isDisabled,
            open: menuIsOpen,
            size,
            error,
          })}
          {...props}
        />
      </div>
    );
  };

  const CustomOption = ({ innerProps, label, isSelected }) => (
    <div
      {...innerProps}
      className={`flex w-full justify-between p-3 text-primary-800 ${
        isSelected && "bg-primary-100"
      }`}
    >
      {label}
      {isSelected && <CheckIcon className="h-5 w-5 text-gray-800" />}
    </div>
  );

  const CustomClearIndicator = (props) => {
    return (
      <components.ClearIndicator {...props}>
        <XMarkIcon className={dropdownIconVariant({ size })} />
      </components.ClearIndicator>
    );
  };

  const optionsWithSelectAll = () => {
    if (multiple && selectAll) {
      return [selectAllOption, ...optionsInput];
    } else {
      return optionsInput;
    }
  };

  return (
    <div className={twMerge(`flex w-full flex-col justify-between`, className)}>
      {label && (
        <label className="font-medium text-gray-900" htmlFor={name}>
          {label}
        </label>
      )}
      <Select
        classNamePrefix="react-select"
        inputId={name}
        isLoading={loading}
        options={optionsWithSelectAll()}
        isMulti={multiple}
        value={selected}
        onChange={handleSelectChange}
        placeholder={placeholder}
        styles={customStyles}
        isDisabled={disabled}
        components={{
          Option: CustomOption,
          Control: ControlOption,
          ClearIndicator: CustomClearIndicator,
        }}
      />
    </div>
  );
};
export default SearchInput;
```